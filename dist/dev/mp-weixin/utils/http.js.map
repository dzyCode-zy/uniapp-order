{"version":3,"file":"http.js","sources":["../../../../src/utils/http.ts"],"sourcesContent":["// 添加拦截器\n// 拦截request 请求\n// 拦截uploadFile 文件上传\n\nimport { useMemberStore } from \"@/stores\";\n\n//TODO\n// 1.非 http 开头的请求需要需要拼接地址\nconst baseURL: string = 'https://pcapi-xiaotuxian-front-devtest.itheima.net'\n\nconst httpInterceptor = {\n    // 拦截前触发\n    invoke(options: UniApp.RequestOptions) {\n        if (!options.url.startsWith('http')) {\n            options.url = baseURL + options.url\n        }\n        // 2.请求超时\n        options.timeout = 10000\n        // console.log(options.timeout)\n        // 3.添加小程序端请求标识 通常用于标识客户端来源\n        //     小程序端： source - client: mini - program\n        // •\tWeb 端： source - client: web\n        // •\tApp 端： source - client: mobile - app\n\n        options.header = {\n            ...options.header,\n            'source-client': \"miniapp\"\n        }\n\n        // 4.添加 token，请求头标识 // 登入成功后获取  存在profile中\n\n        const store = useMemberStore()\n        const token = store.profile?.token\n        console.log(token)\n        if (token) {\n            options.header.Authorization = token\n        }\n    }\n\n}\n// 添加拦截器\n\nuni.addInterceptor('request', httpInterceptor)\nuni.addInterceptor('uploadFile', httpInterceptor)\n\n"],"names":["useMemberStore","uni"],"mappings":";;;;AAQA,MAAM,UAAkB;AAExB,MAAM,kBAAkB;AAAA;AAAA,EAEpB,OAAO,SAAgC;;AACnC,QAAI,CAAC,QAAQ,IAAI,WAAW,MAAM,GAAG;AACzB,cAAA,MAAM,UAAU,QAAQ;AAAA,IACpC;AAEA,YAAQ,UAAU;AAOlB,YAAQ,SAAS;AAAA,MACb,GAAG,QAAQ;AAAA,MACX,iBAAiB;AAAA,IAAA;AAKrB,UAAM,QAAQA,sBAAAA;AACR,UAAA,SAAQ,WAAM,YAAN,mBAAe;AAC7B,YAAQ,IAAI,KAAK;AACjB,QAAI,OAAO;AACP,cAAQ,OAAO,gBAAgB;AAAA,IACnC;AAAA,EACJ;AAEJ;AAGAC,cAAAA,MAAI,eAAe,WAAW,eAAe;AAC7CA,cAAAA,MAAI,eAAe,cAAc,eAAe;"}